<!-- Loading State -->
<div *ngIf="loading" class="loading-container">
  <div class="loading-content">
    <p-progressSpinner
      [style]="{'width': '50px', 'height': '50px'}"
      strokeWidth="4"
      fill="transparent"
      animationDuration="1s">
    </p-progressSpinner>
    <p class="loading-text">Загрузка...</p>
  </div>
</div>

<!-- Error State -->
<div *ngIf="error && !loading" class="error-container">
  <div class="error-content">
    <i class="pi pi-exclamation-triangle error-icon"></i>
    <h3>Что-то пошло не так</h3>
    <p>{{ error }}</p>
    <p-button
      label="Попробовать снова"
      icon="pi pi-refresh"
      (onClick)="onRetryLoad()"
      [outlined]="true">
    </p-button>
  </div>
</div>

<!-- Empty State -->
<div *ngIf="!loading && !error && courses.length === 0" class="empty-container">
  <div class="empty-content">
    <i class="pi pi-book empty-icon"></i>
    <h3>Курсы недоступны</h3>
    <p>В настоящее время теоретические курсы недоступны. Пожалуйста, проверьте позже.</p>
  </div>
</div>

<!-- Courses Section -->
<div *ngIf="!loading && !error && courses.length > 0" class="courses-section">
  
  <!-- Continue Learning Section -->
  <div *ngIf="isAuthenticated && continueLearningCourses.length > 0" class="category-section continue-learning-section">
    <div class="category-header">
      <h2 class="category-title">Продолжить обучение</h2>
    </div>
    
    <div class="courses-grid">
      <app-course-card
        *ngFor="let course of continueLearningCourses; trackBy: trackByCourseId"
        [course]="course"
        [itemCount]="getCourseProgress(course.id).totalItems"
        [completionPercentage]="getCourseProgress(course.id).completionPercentage"
        (courseSelected)="onCourseSelected($event)">
      </app-course-card>
    </div>
  </div>

  <!-- Category Sections -->
  <div *ngFor="let categoryWithCourses of categoriesWithCourses; trackBy: trackByCategoryId" class="category-section">
    <div class="category-header">
      <h2 class="category-title">{{ categoryWithCourses.category.name }}</h2>
      <p *ngIf="categoryWithCourses.category.description" class="category-description">
        {{ categoryWithCourses.category.description }}
      </p>
    </div>
    
    <div class="courses-grid">
      <app-course-card
        *ngFor="let course of categoryWithCourses.courses; trackBy: trackByCourseId"
        [course]="course"
        [itemCount]="getCourseProgress(course.id).totalItems"
        [completionPercentage]="getCourseProgress(course.id).completionPercentage"
        (courseSelected)="onCourseSelected($event)">
      </app-course-card>
    </div>
  </div>

  <!-- Uncategorized Courses Section -->
  <div *ngIf="uncategorizedCourses.length > 0" class="category-section">
    <div class="category-header">
      <h2 class="category-title">Другие курсы</h2>
    </div>
    
    <div class="courses-grid">
      <app-course-card
        *ngFor="let course of uncategorizedCourses; trackBy: trackByCourseId"
        [course]="course"
        [itemCount]="getCourseProgress(course.id).totalItems"
        [completionPercentage]="getCourseProgress(course.id).completionPercentage"
        (courseSelected)="onCourseSelected($event)">
      </app-course-card>
    </div>
  </div>

  <!-- Fallback: If no categories are loaded, show all courses in a single grid -->
  <div *ngIf="categoriesWithCourses.length === 0 && uncategorizedCourses.length === 0 && !categoriesLoading" class="courses-grid">
    <app-course-card
      *ngFor="let course of courses; trackBy: trackByCourseId"
      [course]="course"
      [itemCount]="getCourseProgress(course.id).totalItems"
      [completionPercentage]="getCourseProgress(course.id).completionPercentage"
      (courseSelected)="onCourseSelected($event)">
    </app-course-card>
  </div>
</div>
