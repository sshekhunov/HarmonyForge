<!-- Loading State -->
<div *ngIf="loading" class="loading-container">
  <div class="loading-content">
    <p-progressSpinner
      [style]="{'width': '50px', 'height': '50px'}"
      strokeWidth="4"
      fill="transparent"
      animationDuration="1s">
    </p-progressSpinner>
    <p class="loading-text">Загрузка...</p>
  </div>
</div>

<div class="article-detail-page" *ngIf="loadFromRoute">
  <div class="article-header" *ngIf="article">
    <a class="back-link" (click)="onGoBack()">
      <i class="pi pi-arrow-left"></i> Назад к модулям
    </a>
    <div class="article-title-section">
      <h1 class="article-title">{{ article.title }}</h1>
      <div class="article-meta" *ngIf="moduleTitle">
        <h2 class="module-title">{{ moduleTitle }}</h2>
      </div>
    </div>
  </div>
</div>

<div class="learning-article-container" *ngIf="article && !loading">
  <!-- Article Content -->
  <div class="article-content">
    <div *ngIf="article.contentSections.length === 0" class="no-content">
      <i class="pi pi-file-o no-content-icon"></i>
      <p>Контент статьи пока недоступен.</p>
    </div>

    <!-- Content Sections -->
    <div *ngFor="let section of article.contentSections; trackBy: trackBySectionOrder"
         class="content-section">

      <!-- Section Header -->
      <div class="section-header" *ngIf="section.title">
        <h3 class="section-title">{{ section.title }}</h3>
      </div>

      <!-- Section Content Items -->
      <div class="section-content">
        <div *ngFor="let contentItem of section.contentItems; trackBy: trackByContentItemOrder"
             class="content-item">

          <!-- Text Content -->
          <div *ngIf="contentItem.type === 0" class="text-content">
            <div class="content-wrapper">
              <p class="content-text">{{ contentItem.content }}</p>
            </div>
          </div>

          <!-- Image Content -->
          <div *ngIf="contentItem.type === 1" class="image-content">
            <div class="content-wrapper">
              <img [src]="contentItem.content"
                   [alt]="'Изображение для ' + section.title"
                   class="content-image"
                   loading="lazy">
            </div>
          </div>

          <!-- Video Content -->
          <div *ngIf="contentItem.type === 2" class="video-content">
            <div class="content-wrapper">
              <div *ngIf="isVideoContent(contentItem.content)" class="video-embed">
                <iframe [src]="getVideoEmbedUrl(contentItem.content)"
                        frameborder="0"
                        allowfullscreen
                        class="video-iframe">
                </iframe>
              </div>
              <div *ngIf="!isVideoContent(contentItem.content)" class="video-link">
                <a [href]="contentItem.content" target="_blank" class="video-link-button">
                  <i class="pi pi-video"></i>
                  Открыть видео
                </a>
              </div>
            </div>
          </div>

          <!-- MusicXml Content -->
          <div *ngIf="contentItem.type === 3" class="musicxml-content">
            <div class="content-wrapper">
              <lib-osmd-renderer
                [source]="contentItem.content"
                [showTitleAndAuthor]="false"
                [partName]="getPartName(section.title, contentItem.order)">
              </lib-osmd-renderer>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- No Article State -->
<div *ngIf="!article && !loading" class="no-article">
  <i class="pi pi-file-o no-article-icon"></i>
  <p>Статья не найдена или не загружена.</p>
</div>
