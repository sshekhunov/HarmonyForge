<p-splitter [style]="{'height': '100%', 'width': '100%'}" [panelSizes]="[50, 50]" styleClass="score-analysis-splitter">
  <ng-template pTemplate>
    <div class="splitter-panel panel-content">
      <div class="panel-card">
        <div class="panel-header">
          <h2 class="panel-title">{{ taskTitle }}</h2>
        </div>
        <div class="panel-body">
          <app-learning-content-renderer
            [contentItems]="taskContentItems"
            [sectionTitle]="'Инструкция'">
          </app-learning-content-renderer>
        </div>
      </div>
    </div>
  </ng-template>

  <ng-template pTemplate>
    <p-splitter layout="vertical" [panelSizes]="nestedPanelSizes" styleClass="score-analysis-splitter-nested">
      <ng-template pTemplate>
        <div class="splitter-panel panel-upload">
          <div class="panel-card">
            <div class="panel-header">
              <h2 class="panel-title">Решение</h2>
              <div class="panel-header-actions">
                <p-button
                  label="Загрузить"
                  icon="pi pi-upload"
                  (onClick)="fileInput.click()"
                  [disabled]="isLoading">
                </p-button>
                <p-button
                  label="Проверить"
                  icon="pi pi-sparkles"
                  (onClick)="onUpload(null)"
                  [disabled]="!musicXml || isLoading"
                  [loading]="isLoading">
                </p-button>
                <p-button
                  label="Очистить"
                  icon="pi pi-times"
                  severity="secondary"
                  (onClick)="onClear()"
                  [disabled]="!musicXml || isLoading">
                </p-button>
              </div>
            </div>
            <div class="panel-body">
              <div class="upload-card">
                @if (musicXml == '')
                {
                <div class="upload-dropzone"
                     (click)="fileInput.click()"
                     (dragover)="onDragOver($event)"
                     (dragleave)="onDragLeave($event)"
                     (drop)="onDrop($event)">
                  <div class="flex items-center justify-center flex-col upload-empty">
                    <i class="pi pi-cloud-upload upload-icon"></i>
                    <p class="mt-6 mb-0">Перетащите файл в формате MusicXml</p>
                  </div>
                </div>
                }
                @else
                {
                <div class="uploaded-preview">
                  <lib-osmd-renderer [source]="musicXml"></lib-osmd-renderer>
                </div>
                }
                <input
                  #fileInput
                  type="file"
                  accept=".musicxml,.xml"
                  style="display: none;"
                  (change)="onFileSelected($event)">
              </div>

              @if (isLoading)
              {
              <div class="loading-indicator">
                  <i class="pi pi-spin pi-spinner text-2xl mr-2"></i>
                  <span>Анализ...</span>
              </div>
              }
            </div>
          </div>
        </div>
      </ng-template>

      <ng-template pTemplate>
        <div class="splitter-panel panel-results">
          <div class="panel-card">
            <div class="panel-header">
              <h2 class="panel-title">Результат</h2>
            </div>
            @if (checkResult != '')
            {
            <div class="panel-body">
              <div class="result-content">
                  <h3 class="result-title">Результат анализа</h3>
                  <p class="result-text">{{ checkResult }}</p>

                  @if (noteCount > 0)
                  {
                  <div class="result-success">
                      <div class="flex items-center">
                          <i class="pi pi-check-circle text-green-600 mr-2"></i>
                          <span class="text-green-800 font-medium">Найдено нот: {{ noteCount }}</span>
                      </div>
                  </div>
                  }
              </div>
            </div>
            }
          </div>
        </div>
      </ng-template>
    </p-splitter>
  </ng-template>
</p-splitter>

